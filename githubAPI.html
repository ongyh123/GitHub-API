<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Github API</title>
  </head>
  <body>
    <h1>GitHub API</h1>

    <div id="github">
      <p>
        <a href="https://github.com/ongyh123" target="_blank"
          >View my GitHub Profile</a
        >
      </p>
    </div>
    <script>
      // Get the DOM nodes
      let github = document.querySelector('#github');

      // Call the GitHub API
      Promise.all([
        fetch('https://api.github.com/users/ongyh123'),
        fetch('https://api.github.com/users/ongyh123/repos?sort=pushed'),
      ])
        .then(function (responses) {
          return Promise.all(
            responses.map(function (response) {
              return response.json();
            })
          );
        })
        .then(function (data) {
          console.log(data);
          render(data);
        })
        .catch(function (error) {
          console.warn(error);
        });

      // Render the data in the UI
      function render(data) {
        // Get variables from the data
        let [profile, repos] = data;

        // Sort the repos by stars
        repos.sort(function (repo1, repo2) {
          if (repo1.stargazers_count > repo2.stargazers_count) {
            return -1;
          }
          return 1;
        });

        // Only display 5 most starred repositories
        repos = repos.slice(0, 5);

        github.innerHTML = `<div>
                    <div>
                        <p><img alt="profile image" src="${data.avatar_url}"></p>
                    </div>
                    <div>
                        <p>
                            ${data.name}
                            ${data.location}
                            <a href="${data.url}">${data.public_repos} public repos</a>
                        </p>
                    </div>
                </div>`;
      }
    </script>
  </body>
</html>
